<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Playlistor - Spotify Playlist Time Sequencer</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <header>
            <h1>üéµ Playlistor</h1>
            <p class="subtitle">Sequence Spotify playlists with time-anchored songs</p>
            <div id="auth-status">
                <button id="login-btn" class="btn btn-primary" style="display: none;">Login with Spotify</button>
                <button id="disconnect-btn" class="btn btn-secondary btn-sm" style="display: none;">Disconnect</button>
                <span id="auth-indicator" class="auth-indicator"></span>
            </div>
            <div id="alt-auth" class="alt-auth" style="display: none;">
                <button id="toggle-alt-auth" class="btn-link">Or use session cookie / token instead</button>
                <div id="alt-auth-panel" class="alt-auth-panel" style="display: none;">
                    <div class="alt-auth-tab-btns">
                        <button class="alt-auth-tab-btn active" data-tab="token">Access Token (recommended)</button>
                        <button class="alt-auth-tab-btn" data-tab="cookie">sp_dc Cookie</button>
                    </div>
                    <div id="tab-token" class="alt-auth-tab active">
                        <p class="help-text"><strong>Easiest method:</strong> Open <a href="https://open.spotify.com/get_access_token?reason=transport&amp;productType=web-player" target="_blank" style="color: #a0c4ff;">this link</a> in a browser where you&rsquo;re logged into Spotify, then copy the <code>accessToken</code> value from the JSON.</p>
                        <div class="input-group">
                            <input type="text" id="token-input" placeholder="Paste access token here">
                            <button id="token-auth-btn" class="btn btn-primary">Connect</button>
                        </div>
                    </div>
                    <div id="tab-cookie" class="alt-auth-tab" style="display: none;">
                        <p class="help-text">Open <strong>open.spotify.com</strong> &rarr; DevTools (F12) &rarr; Application &rarr; Cookies &rarr; copy the <code>sp_dc</code> value. <em>Note: may not work in all environments.</em></p>
                        <div class="input-group">
                            <input type="text" id="sp-dc-input" placeholder="Paste sp_dc cookie value">
                            <button id="cookie-auth-btn" class="btn btn-primary">Connect</button>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <main>
            <!-- Step 1: Load Playlist -->
            <section class="card">
                <h2>1. Load Playlist</h2>
                <div class="input-group">
                    <input type="text" id="playlist-id" placeholder="Enter Spotify Playlist ID (e.g., 2PNI5NdD3372si8LuR7guq)">
                    <button id="fetch-btn" class="btn btn-primary">Fetch Playlist</button>
                </div>
                <div id="playlist-info" class="playlist-info" style="display: none;">
                    <h3 id="playlist-name"></h3>
                    <p><span id="track-count"></span> tracks loaded</p>
                </div>
            </section>

            <!-- Step 2: Add Anchors -->
            <section class="card">
                <h2>2. Add Anchor Songs</h2>
                <p class="help-text">Specify songs to play at exact times. First anchor is from playlist start, others are relative to previous anchor.</p>
                
                <div class="anchor-form">
                    <div class="autocomplete-wrapper">
                        <input type="text" id="anchor-song-name" placeholder="Song name (start typing to search)" autocomplete="off">
                        <div id="song-suggestions" class="suggestions-dropdown"></div>
                    </div>
                    <div class="time-inputs">
                        <input type="number" id="anchor-hours" min="0" placeholder="Hours" value="0">
                        <span>:</span>
                        <input type="number" id="anchor-minutes" min="0" max="59" placeholder="Minutes" value="0">
                        <span>:</span>
                        <input type="number" id="anchor-seconds" min="0" max="59" placeholder="Seconds" value="0">
                    </div>
                    <button id="add-anchor-btn" class="btn btn-secondary">Add Anchor</button>
                </div>

                <div id="anchors-list" class="anchors-list"></div>

                <div class="action-group">
                    <button id="sequence-btn" class="btn btn-primary" disabled>Generate Sequence</button>
                    <button id="clear-anchors-btn" class="btn btn-secondary">Clear Anchors</button>
                </div>

                <div class="crossfade-control">
                    <label for="crossfade-seconds">Crossfade: <strong id="crossfade-value">5</strong>s</label>
                    <input type="range" id="crossfade-seconds" min="0" max="12" step="1" value="5">
                    <span class="help-text">Songs overlap by this many seconds. Set to 0 to disable.</span>
                </div>
            </section>

            <!-- Step 3: Review & Edit Sequence -->
            <section class="card">
                <h2>3. Review & Edit Sequence</h2>
                <p class="help-text">Drag tracks to reorder. Anchor songs are highlighted.</p>
                
                <div id="sequence-container" style="display: none;">
                    <div class="sequence-stats">
                        <span>Total Duration: <strong id="total-duration">0:00:00</strong></span>
                        <button id="reshuffle-btn" class="btn btn-secondary">Re-shuffle Gaps</button>
                    </div>
                    
                    <div id="tracks-list" class="tracks-list"></div>
                </div>

                <div id="sequence-placeholder" class="placeholder">
                    Generate a sequence to see tracks here
                </div>
            </section>

            <!-- Step 4: Upload to Spotify -->
            <section class="card">
                <h2>4. Upload to Spotify</h2>
                <div class="input-group">
                    <input type="text" id="new-playlist-name" placeholder="New playlist name">
                    <button id="upload-btn" class="btn btn-success" disabled>Create Playlist</button>
                </div>
                <div id="upload-result" class="upload-result" style="display: none;"></div>
            </section>
        </main>

        <footer>
            <p>Made with ‚ù§Ô∏è for music lovers | Data auto-saved</p>
        </footer>
    </div>

    <!-- Error Toast -->
    <div id="error-toast" class="toast error-toast" style="display: none;"></div>
    <div id="success-toast" class="toast success-toast" style="display: none;"></div>

    <script src="{{ url_for('static', filename='app.js') }}"></script>
</body>
</html>
